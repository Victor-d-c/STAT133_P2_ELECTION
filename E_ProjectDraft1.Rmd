---
title: "Election Project"
Author: Menglu Cao, Jieni Wan, Qichen Sun, John Towey
output: html_document
---

### STEP 1: DATA WRANGLING

## Election Results in 2004
```{r}
# Code by Menglu Cao
countyVotes2004 = read_delim("http://www.stat.berkeley.edu/~nolan/data/voteProject/countyVotes2004.txt", delim = ' ')

# Split state names and county names
names = strsplit(countyVotes2004$countyName, split = ",")

# State names
countyVotes2004$State = sapply(names, function(x) x[1])

# County names
cNames = sapply(names, function(x) x[2])
# Use regular expressions and string munipulations to clean county names
# Convert	all	county names to lower case
cNames = tolower(cNames)
# Remove blanks in county names
cNames = gsub(" ", "", cNames)
# Change & to and in county names
cNames = gsub("&", "and", cNames)
# Remove county or parish from county names
cNames = gsub("county|parish", "", cNames, ignore.case = TRUE)
# Eliminate	.	from county names
cNames = gsub("\\.", "", cNames)

# County names after cleaning
countyVotes2004$County = cNames

countyVotes2004 = countyVotes2004[,c(4,5,2,3)]
names(countyVotes2004)[c(3,4)] = c("bushVote2004", "kerryVote2004")
```

## Election Results in 2008
```{r}
# Code by Qichen Sun
countyVotes2008 = read.csv("countyVotes2008.csv")
cNames = countyVotes2008$County
cNames = tolower(cNames)
cNames = gsub(" ", "", cNames)
cNames = gsub("&", "and", cNames)
cNames = gsub("county|parish", "", cNames)
cNames = gsub("\\.", "", cNames)
countyVotes2008$County = cNames
names(countyVotes2008)[c(4,5)] = c("obamaVote2008", "mcCainVote2008")
countyVotes2008 = countyVotes2008[,c(1,4,5)]
```

## Election Results in 2012
```{r}
# Code by Jieni Wan
stateNames = read.csv("http://www.stat.berkeley.edu/users/nolan/data/voteProject/countyVotes2012/stateNames.txt")
stateNames = as.vector(stateNames$states)
stateNames = stateNames[-2]

library(XML)
xml2012 = paste0("http://www.stat.berkeley.edu/users/nolan/data/voteProject/countyVotes2012/", stateNames, ".xml")
xmlList = lapply(xml2012, xmlParse)
Obama = lapply(xmlList, function(x){
  xpathSApply(xmlRoot(x), "//abbr[@title='Democratic']/../../td[@class='results-percentage']", xmlValue)
})
Romney = lapply(xmlList, function(x){
  xpathSApply(xmlRoot(x), "//abbr[@title='Republican']/../../td[@class='results-percentage']", xmlValue)
})
County = lapply(xmlList, function(x){
  xpathSApply(xmlRoot(x), "/table/tbody/tr/th[ @class='results-county']", xmlValue)
})

ObamaVote2008 = unlist(Obama)
RomneyVote2008 = unlist(Romney)
County = unlist(County)
County = gsub(" 100.0% Reporting", "", County)
countyVotes2012 = data.frame(County, ObamaVote2008, RomneyVote2008)

#problems: class of ObamaVote2008, RomneyVote2008 is character and after using unlist function, the two vectors have names for each elements.
```

## Election Results in 2016
```{r}

```

## GML data that contains the latitude and longitude for each county
```{r} 
# Code by Menglu Cao
GML = xmlParse("http://www.stat.berkeley.edu/users/nolan/data/voteProject/counties.gml")
doc = xmlRoot(GML)
cNames = as.character(xpathSApply(doc, "/doc/state/county/gml:name", xmlValue))
cNames = tolower(cNames)
cNames = gsub(" ", "", cNames)
cNames = gsub("&", "and", cNames)
cNames = gsub("county|parish", "", cNames)
cNames = gsub("\\.", "", cNames)
cNames = gsub("\n", "", cNames)

Longitude = as.numeric(xpathSApply(doc, "/doc/state/county/gml:location/gml:coord/gml:X", xmlValue))
Latitude = as.numeric(xpathSApply(doc, "/doc/state/county/gml:location/gml:coord/gml:Y", xmlValue))

GML_df = data.frame(cNames, Latitude, Longitude, stringsAsFactors = FALSE)
```

## Census data from the 2010 census
```{r}
#Code by John Towey

B01003 = read.csv("http://www.stat.berkeley.edu/~nolan/data/voteProject/census2010/B01003.csv")

# TOTAL POPULATION 
totalPop = B01003$HD01_VD01 #1 Total population

DP02 = read.csv("http://www.stat.berkeley.edu/~nolan/data/voteProject/census2010/DP02.csv")

# FAMILY STRUCTURE 
familiesWithKids = DP02$HC03_VC06 #2 Percent of households that are families with Children under 18
singleDads = DP02$HC03_VC10 #3 Percent households with a single male head of household with children under 18
singleMoms = DP02$HC03_VC12 #4 Percent of households with a single female head of household with children under 18
seniorsLivingAlone = DP02$HC03_VC15 #5 Housholder living alone, 65 years old or over

DP03 = read.csv("http://www.stat.berkeley.edu/~nolan/data/voteProject/census2010/DP03.csv")

# EMPLOYMENT
laborForce = DP03$HC03_VC06 #6 Labor Force Participation Rate (percent over 16 years old who are employed or unemployed)
unemployed = DP03$HC03_VC08 #7 Unemployment Rate (percent over 16 unemployed)
femaleLaborForce = DP03$HC03_VC17 #8 Female labor force participation rate (percent of females over 16 who are employed or unemployed)
employedWomen = DP03$HC03_VC18 #9 Women over 16 who are employed 
femaleUnemployment = femaleLaborForce - employedWomen #10 Female Unemployment Rate

# EMPLOYMENT BY OCCUPATIONS
occManagement = DP03$HC03_VC41 #11 Pecent of the civilian labor force employed in management, business, science, and arts occupations
occService = DP03$HC03_VC42 #12 Percent of the civilian labor force employed in service occupations 

# EMPLOYMENT BY INDUSTRY
extractiveIndustries = DP03$HC03_VC50 #13 Percent of the civilian labor force employed in agriculture, forestry, fishing and hunting, and mining industries 
constructionInustry = DP03$HC03_VC51 #14 Percent of the civilian labor force employed in the construction industry
manufacturingIndustry = DP03$HC03_VC52 #15 Percent of the civilian labor force employed in the manufacturing industry
retailIndustry = DP03$HC03_VC54 #16 Percent of the civilian labor force employed in the retail trade industry
professionalIndustries = DP03$HC03_VC58 #17 Percent of the civilian labor force employed in Professional, scientific, and management, and administrative and waste management services industries

# MERGE
censusDataFrame = merge(x = B01003, y = DP02, z = DP03, all = TRUE)

cNamesD3 = as.character(censusDataFrame$GEO.display.label)
cNamesD3 = gsub(" ", "", cNames) 
cNamesD3 = gsub("&", "and", cNames) 
cNamesD3 = gsub("county|parish", "", cNames) 
cNamesD3 = gsub("\\.", "", cNames)
cNamesD3 = tolower(cNames)

#Still needs more work. I'll get to it asap...
```

## Final Merge
At last, we can merge all of the data into one data frame. 

